---
title: "Python依赖检测技术发展"
date: 2020-01-02 21:28:06 
description: "依赖检测相关研究"
tag: 依赖检测
---


# Python 依赖检测

## DockerizeMe

## V2 配置漂移检测

&emsp;&emsp;V2主要处理Python代码执行中包过期导致的执行失败问题，主要原因是某些API发生了较大变化，V2主要工作集中在修复此类错误，包括候选环境生成和环境验证。

### 候选环境生成

&emsp;&emsp;**Python2 or Python3** ： 主要通过Python内建AST模块检查代码是2或3，或者将2和3都加入候选环境。

&emsp;&emsp;**环境->依赖集合**： 这里主要利用DockerizeMe的依赖解析和推断，包括直接依赖项和传递依赖项。通过知识图返回包的正确安装顺序，这里包的版本都是最新的，因为DockerizeMe没有对版本进行处理。（runtime, depedency）这样一个tuple组成一个候选环境。

### 环境验证

&emsp;&emsp;给定候选环境和代码片段，记录执行返回值。验证包括两步，第一步配置环境，第二步执行代码。第一步，使用DOcker容器创建执行环境，依次安装依赖，有错误会记录下来，但不会中止。第二步在这个配好的环境中执行代码，如果顺利执行返回Success，否则标记Exception，并记录exception名称、信息和跟踪栈信息等等。规定时间内未执行完成的标记为TimeOut。

### 环境变化

&emsp;&emsp;环境变化的修改操作主要支持基于语义的版本规范和版本变化知识库。

&emsp;&emsp;语义版本： 语义版本是一种版本控制方案，包括major、minor、patch和预发布。一般较大的变化会发生在major版本，兼容老版本的API则发布为次要版本（minor）同时1.0.0之前的都认为是非稳定版本，即通过版本的标记or级别在辨别是否发生了重大变化。【问题是所有包遵守这种规范】 V2定义两种版本回退方法：主版本回退和次版本回退，假如某包有1.1.0/2.1.0/2.3.0，主版本回退会从2.3.0直接回退到1.1.0，但是次版本回退会从2.3.0回退到2.1.0。
&emsp;&emsp;升级矩阵： 结合上一步，所有包的版本的组合方案很多，依靠暴力搜索找到正确环境比较困难，因此提出确定优先级或剪枝方案以加快寻找速度。借助一个项目依赖管理工具来对这个进行挖掘，该工具在用户修改依赖项配置后会触发重新下载构建事件，分析版本变化以及因此造成的错误率来评价每次升级的版本间相似性大小。分析数据通过Google Big-Query获取，挖掘到7104个升级事件，有193个出现了至少一个错误。从版本间变化造成的错误矩阵中可以发现哪些版本间变化较大，从而确定版本回退的优先级。

### 反馈驱动搜索

&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;
